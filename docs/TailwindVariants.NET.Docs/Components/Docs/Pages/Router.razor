@page "/docs/{*slug}"
@attribute [DiscoverCollocatedJS]
@inject NavigationManager Navigation
@inject MarkdownRenderer MarkdownRenderer

<HeadContent>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism-tomorrow.min.css" media="(prefers-color-scheme: dark)">
</HeadContent>

@if (_content is null)
{
    <div class="flex h-full items-center justify-center">
        <div class="spinner-border inline-block h-8 w-8 animate-spin rounded-full border-4 text-gray-600" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}
else
{
    <div class="prose prose-sm mx-auto px-4 py-8 md:prose md:max-w-4xl dark:prose-invert">
        @((MarkupString)_content)
    </div>
}

<JS For="this" />

@code
{
    [Parameter] public string? Slug { get; set; }
    private string? _content;

    protected override async Task OnInitializedAsync()
    {
        if (string.IsNullOrEmpty(Slug))
        {
            Navigation.NavigateTo("/docs/getting-started", true);
            return;
        }

        var filepath = Path.Combine("wwwroot", "docs", Path.ChangeExtension(Slug, ".md"));

        if (!File.Exists(filepath))
        {
            Navigation.NavigateTo("/404", true);
            return;
        }

        _content = await MarkdownRenderer.RenderAsync(filepath);
    }
}